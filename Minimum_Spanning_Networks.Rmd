```{r,message=FALSE,echo=FALSE}
  html <- TRUE
  library("knitcitations")
  library("knitr")
  cite_options(citation_format = "pandoc", max.names = 3, style = "html", hyperlink = "to.doc")
  bib <- read.bibtex("bibtexlib.bib")
  opts_chunk$set(tidy = FALSE, message = FALSE, warning = FALSE, 
                 fig.width = 10, fig.height = 6, cache = TRUE)
  if (html) opts_chunk$set(out.width = "700px", dpi = 300)
  # use this to set knitr options: 
  # http://yihui.name/knitr/options #chunk_options
```

---
title: "99: Minimum Spanning Networks"
---

Minimum spanning networks are a great way to be able to visualize the connections between samples in your data set. In terms of clonal organisms, it can be a more powerful visualization tool than trees, especially for clonal organisms. 

The rest of this chapter will utilize Bruvo's distance `r citep(bib['bruvo2004simple'])`. 
It is important to note that calculating Bruvo's distance is computationally
different than other distances, so it has its own specialized functions for
minimum spanning networks and bootstrapping that do not need a distance matrix:

| General function | Bruvo specific |
| ---- | ---- |
| `poppr.msn` | `bruvo.msn` |
| `aboot` | `bruvo.boot` |

Minimum spanning network
----

For this section, we will use the `monpop` data set from `r citep(bib['everhart2014finescale'])`. 
See [Chapter6](Genotypic_EvenRichDiv.html) for more details. We will be focusing
on sources of multilocus genotypes. The life cycle of the pathogen *Monilinia
fructicola* begins with an ascospore (sexual propagule) released from a
mummified peach fruit that had overwintered on the ground. It infects an
emerging blossom that, in turn, asexually infects fruit, which proceed with
cyclical infections. We might have questions such as:

1. Are the major genotypes of Fruit Rot (FR) samples closely related?
2. To what degree do the Blossom Blight (BB) samples contribute to the FR?


Let's load the data:

```{r}
library("poppr")
library("magrittr")
data(monpop)
splitStrata(monpop) <- ~Tree/Year/Symptom
summary(monpop)
```

We notice that tree number 26 is the only one to have been sampled for all three
years. Let's use it as an example.

```{r}
t26 <- monpop %>% setPop(~Tree) %>% popsub("26") %>% setPop(~Year/Symptom)
t26
```

Now that we have our tree, let's calculate a MSN using Bruvo's distance 
`r citep(bib['bruvo2004simple'])`. Remember that this distance is based on a 
stepwise mutation model, so we have to first specify what kind of repeats units 
we have in our data (eg. dinucleotide = 2, trinucleotide = 3, etc.):

```{r}
# Set up our repeat lengths and populations to analyze
reps <- c(CHMFc4 = 7, CHMFc5 = 2, CHMFc12 = 4, 
          SEA = 4, SED = 4, SEE = 2, SEG = 6,
          SEI = 3, SEL = 4, SEN = 2, 
          SEP = 4, SEQ = 2, SER = 4)

sub9 <- c("9_BB", "9_FR")

# Calculate the MSN
t26.9msn <- bruvo.msn(t26, replen = reps, sublist = sub9, showplot = FALSE)
```

The minimum spanning network is calculated via `bruvo.msn`. I've set the
argument `showplot = FALSE` because I want to use the more powerful function
`plot_poppr_msn` to view the MSN. In this, I'm telling it to lable none of the
samples, color populations using the "cm.colors" palette and scale the size of
the nodes to $log_{1.25}$. If you want to know what other things this function
can do, simply type `help("plot_poppr_msn")`

```{r, fig.width = 7, fig.height = 7}
# Visualize the network
set.seed(9001)
plot_poppr_msn(t26, t26.9msn, inds = "none", palette = cm.colors, nodebase = 1.25)
```

We can see that the Blossom Blight in the tree (pink pie pieces) heavily
contributed to the major groups of MLGs found in the Fruit Rot (blue pie
pieces).

> **Try it!** See if you can produce similar graphs with the 2010 and 2011 populations.