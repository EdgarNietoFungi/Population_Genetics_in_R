```{r,message=FALSE,echo=FALSE}
  html <- TRUE
  library(knitcitations)
  bib <- read.bibtex("bibtexlib.bib")
  opts_chunk$set(tidy = FALSE, message = FALSE, warning = FALSE, 
                 fig.width = 10, fig.height = 6, cache = TRUE)
  if (html) opts_chunk$set(out.width = "700px", dpi = 300)
```
---
title: "Chapter 3:  Data format, loading into R, and first analysis"
---

This chapter introduces basic use of and navigation in *poppr* as well as good practices when starting an analysis. We will start by loading data into R and *poppr* and glance at the genotypic diversity observed in populations and allelic frequencies observed in your loci by population. Both of these are good first steps to eliminate data entry errors, check for missing/rare data and make sure all loci conform to expectations given your analyses.

Loading data
-----

We will use AFLP data for a population of the diploid plant pathogen *Aphanomyces euteiches* to get started [`r citep(bib[c("grunwald2006hierarchical")])`](http://grunwaldlab.cgrb.oregonstate.edu/hierarchical-analysis-diversity-selfing-and-genetic-differentiation-populations-oomycete-aphanomyces). This data can also be downloaded from [figshare](http://dx.doi.org/10.6084/m9.figshare.877104) by copying the link from the `Download` button. A total of 187 pathogen isolates were sampled hierarchically in two regions in Oregon (N = 97) and Washington (N = 90), respectively. Let's first load the data:


```{r library, message = TRUE}
library(poppr) # Load poppr package
data(Aeut)     # Load A. euteiches data stored within poppr

# Optional, load the data from figshare:
Aeut.figshare <- read.genalex("http://files.figshare.com/1314228/rootrot.csv")
```

Let's make sure the data is loaded appropriately:

```{r}
Aeut          # The data set in poppr
Aeut.figshare # the data set from the internet
```

As we can see, the data has the expected 56 loci and $N$ = 187 individuals. 

Looking at allele frequencies
-----

A good first step after loading data is to look for missing data, rare alleles and overall quality of your data:

```{r}
data(nancycats)
locus_table(nancycats)
info_table(nancycats, plot = TRUE, percent = FALSE) # Search for missing data.
```

If your data consists of polyploid SSR markers, you would code the unobserved alleles as
"0". An example for this is the *Phyophthora infestans* data set from `r citep(bib['goss2014irish'])`, which is a subset of a tetraploid data set. In this example, each row represents
an isolate and each column represents a locus:

```{r}
data(Pinf)
Pinf
tail(genind2df(Pinf, sep = "/"))
```

To observe the different levels of ploidy in your data, use the function
`info_table` with the argument `type = "ploidy"`:

```{r}
Pinf.ploidy <- info_table(Pinf, type = "ploidy", plot = TRUE)
tail(Pinf.ploidy)
```

You are now able to assess the quality of your data and examine allelic diversity in your populations. In the next section we will learn how to calculate genotypic diversity.

Calculating genotypic diversity
-----

Let us get a first impression of the diversity found in this data using the
summary function, `poppr`:

```{r}
poppr(Aeut)
```

We can see statistics printed for each individual and the total population. The fields you see in the output include:

- `Pop`  -  Population name.
- `N` -  Number of individuals observed.
- `MLG` - Number of multilocus genotypes (MLG) observed.
- `eMLG` - The number of expected MLG at the smallest sample size ≥ 10 based on rarefaction `r citep(bib[c("hurlbert1971nonconcept")])`.
- `SE` - Standard error based on eMLG.
- `H` - Shannon-Wiener Index of MLG diversity `r citep(bib[c("shannon2001mathematical")])`.
- `G` - Stoddart and Taylor’s Index of MLG diversity  `r citep(bib[c("stoddart1988genotypic")])`.
- `Hexp` - Nei’s expected heterozygosity (denoted elsewhere as D)  `r citep(bib[c("nei1978estimation")])`.
- `E.5` - Evenness, E5 `r citep(bib[c("pielou1975ecological","ludwig1988statistical","grunwald2003")])`.
- `Ia` - The index of association, $I_A$ `r citep(bib[c("brown1980multilocus","smith1993clonal")])`.
- `rbarD` - The standardized index of association, $\bar{r}_d$ `r citep(bib[c("agapow2001indices")])`.

What does all this mean? Both populations have a similar number of individuals ($N$ = 90 and 97) sampled. However, one population has 50 and the other 70 $MLG$ while both populations together have combined 119 $MLG$. Genotypic diversity (either $H$ or $G$) is higher in population 1 than population 2, while evenness is similar. Let's ignore $I_A$ and $\bar{r}_d$ for now, as these are measures of linkage disequilibrium that will be covered in [Chapter 7](C7_Linkage_disequilibrium.html). 

Next, let's calculate $MLG$ for each population, e.g. "Athena" and "Mt. Vernon" populations:

```{r}
A.tab <- mlg.table(Aeut)
```

The figures provide histograms to see how evenly $MLGs$ are distributed within each population. Both populations have genotypes that occur a few times and only a few genotypes that occur more than 5 times (as expected from the high $E_5$ discussed above). Feel free to explore the actual published data to see how this work was interpreted previously `r citep(bib[c("grunwald2006hierarchical")])`.

This concludes our first introduction on how to count genotypes and determine genotypic diversity, evenness and richness in populations. In the [next chapter](C4_Population_Hierarchies) we will learn how to subset and clone-correct populations. 

References
----------
```{r,echo=FALSE, results='asis', cache = FALSE}
  bibliography(style = "html", bulleted=FALSE)
```
